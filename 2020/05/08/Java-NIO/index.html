<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"blog.pgsky.cn","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="Java NIO学习笔记一、Java NIO简介Java NIO是从Java1.4版本开始引入的一个新的IO API，可以替代标准的Java IO API。NIO与原来的IO有同样的作用和目的，但是使用的方式完全不同，NIO支持面向缓冲区、基于通道的IO操作。NIO将以更加高效的方式进行文件的读写操作 二、Java NIO 与 IO 的主要区别   IO NIO    面向流 面向缓冲区   阻塞">
<meta property="og:type" content="article">
<meta property="og:title" content="Java NIO学习笔记">
<meta property="og:url" content="https://blog.pgsky.cn/2020/05/08/Java-NIO/index.html">
<meta property="og:site_name" content="Sky1225">
<meta property="og:description" content="Java NIO学习笔记一、Java NIO简介Java NIO是从Java1.4版本开始引入的一个新的IO API，可以替代标准的Java IO API。NIO与原来的IO有同样的作用和目的，但是使用的方式完全不同，NIO支持面向缓冲区、基于通道的IO操作。NIO将以更加高效的方式进行文件的读写操作 二、Java NIO 与 IO 的主要区别   IO NIO    面向流 面向缓冲区   阻塞">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://blog.pgsky.cn/Users/yyk/Library/Application%20Support/typora-user-images/image-20200421092652990.png">
<meta property="og:image" content="https://blog.pgsky.cn/Users/yyk/Library/Application%20Support/typora-user-images/image-20200421095630061.png">
<meta property="og:image" content="https://blog.pgsky.cn/Users/yyk/Library/Application%20Support/typora-user-images/image-20200421100128998.png">
<meta property="og:image" content="https://blog.pgsky.cn/Users/yyk/Library/Application%20Support/typora-user-images/image-20200421172908408.png">
<meta property="article:published_time" content="2020-05-08T09:48:25.000Z">
<meta property="article:modified_time" content="2020-05-08T09:59:40.028Z">
<meta property="article:author" content="余永康">
<meta property="article:tag" content="NIO">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://blog.pgsky.cn/Users/yyk/Library/Application%20Support/typora-user-images/image-20200421092652990.png">

<link rel="canonical" href="https://blog.pgsky.cn/2020/05/08/Java-NIO/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>Java NIO学习笔记 | Sky1225</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Sky1225</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://blog.pgsky.cn/2020/05/08/Java-NIO/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://edu-online-1258760161.cos.ap-guangzhou.myqcloud.com/2020/06/30/240c57a76f364ab59770c641afc2693c11.jpg">
      <meta itemprop="name" content="余永康">
      <meta itemprop="description" content="只有光头才能变强">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sky1225">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Java NIO学习笔记
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2020-05-08 17:48:25 / Modified: 17:59:40" itemprop="dateCreated datePublished" datetime="2020-05-08T17:48:25+08:00">2020-05-08</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="Java-NIO学习笔记"><a href="#Java-NIO学习笔记" class="headerlink" title="Java NIO学习笔记"></a>Java NIO学习笔记</h1><h2 id="一、Java-NIO简介"><a href="#一、Java-NIO简介" class="headerlink" title="一、Java NIO简介"></a>一、Java NIO简介</h2><p>Java NIO是从Java1.4版本开始引入的一个新的IO API，可以替代标准的Java IO API。NIO与原来的IO有同样的作用和目的，但是使用的方式完全不同，NIO支持面向缓冲区、基于通道的IO操作。NIO将以更加高效的方式进行文件的读写操作</p>
<h2 id="二、Java-NIO-与-IO-的主要区别"><a href="#二、Java-NIO-与-IO-的主要区别" class="headerlink" title="二、Java NIO 与 IO 的主要区别"></a>二、Java NIO 与 IO 的主要区别</h2><table>
<thead>
<tr>
<th>IO</th>
<th>NIO</th>
</tr>
</thead>
<tbody><tr>
<td>面向流</td>
<td>面向缓冲区</td>
</tr>
<tr>
<td>阻塞IO</td>
<td>非阻塞IO</td>
</tr>
<tr>
<td></td>
<td>选择器</td>
</tr>
</tbody></table>
<h2 id="三、通道和缓冲区"><a href="#三、通道和缓冲区" class="headerlink" title="三、通道和缓冲区"></a>三、通道和缓冲区</h2><p>Java NIO 系统的核心在于：通道和缓冲区。</p>
<p>通道表示打开到 IO 设备的连接。若需要使用NIO系统，需要获取用于连接IO设备的通道以及用于容纳数据的缓冲区。然后操作缓冲区，对数据进行处理。</p>
<h3 id="1-缓冲区"><a href="#1-缓冲区" class="headerlink" title="1. 缓冲区"></a>1. 缓冲区</h3><h4 id="（1）缓冲区的基本概念"><a href="#（1）缓冲区的基本概念" class="headerlink" title="（1）缓冲区的基本概念"></a>（1）缓冲区的基本概念</h4><ul>
<li><p>缓冲区：一个用于特定基本数据类型的容器，由java.nio包定义的，所有缓冲区都是Buffer抽象类的子类。</p>
</li>
<li><p>Java NIO中的Buffer主要用于与NIO通道进行交互，数据是从通道读入缓冲区，从缓冲区写入通道中的。</p>
</li>
<li><p>Buffer就像一个数组，可以保存多个相同类型的数据，根据数据类型不同（boolean除外），有以下Buffer常用子类：</p>
<ul>
<li>ByteBuffer</li>
<li>CharBuffer</li>
<li>ShortBuffer</li>
<li>IntBuffer</li>
<li>LongBuffer</li>
<li>FloatBuffer</li>
<li>DoubleBuffer</li>
</ul>
<p>上述 Buffer 类，他们都采用相似的方法进行管理数据，只是各自管理的数据类型不同而已。都是通过如下方法获取一个容量为capacity的Buffer对象</p>
<pre class=" language-java"><code class="language-java"><span class="token keyword">static</span> XxxBuffer <span class="token function">allocate</span><span class="token punctuation">(</span><span class="token keyword">int</span> capacity<span class="token punctuation">)</span></code></pre>
</li>
</ul>
<h4 id="（2）缓冲区的基本属性"><a href="#（2）缓冲区的基本属性" class="headerlink" title="（2）缓冲区的基本属性"></a>（2）缓冲区的基本属性</h4><ul>
<li><p>Buffer中的重要概念</p>
<ul>
<li>容量（capacity）：表示Buffer最大数据容量。缓冲区的容量不能为负，并且创建后不能更改。</li>
<li>限制（limit）：位于limit后的数据不可读写。缓冲区的限制不能为负，且不能大于其容量。</li>
<li>位置（position）：下一个要读取或写入数据的索引。缓冲区的位置不能为负，并且不能大于其限制。</li>
<li>标记（mark）与重置（reset）：标记是一个索引，通过Buffer中的mark()方法指定Buffer中一个特定的position，之后可以通过reset()方法恢复到这个position。</li>
</ul>
<p><strong>0 &lt;= mark &lt;= position &lt;= limit &lt;= capacity</strong></p>
<img src="/Users/yyk/Library/Application Support/typora-user-images/image-20200421092652990.png" alt="image-20200421092652990" style="zoom:50%;" />

</li>
</ul>
<h4 id="（3）缓冲区的常用方法"><a href="#（3）缓冲区的常用方法" class="headerlink" title="（3）缓冲区的常用方法"></a>（3）缓冲区的常用方法</h4><table>
<thead>
<tr>
<th>方法</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>Buffer clear()</td>
<td>清空缓冲区并返回对缓冲区的引用</td>
</tr>
<tr>
<td>Buffer flip()</td>
<td>将缓冲区的界限设置为当前位置，并将当前位置重置为0</td>
</tr>
<tr>
<td>int capacity()</td>
<td>返回Buffer 的 capacity</td>
</tr>
<tr>
<td>int limit()</td>
<td>返回Buffer 的 limit</td>
</tr>
<tr>
<td>int position()</td>
<td>返回Buffer 的 position</td>
</tr>
<tr>
<td>Buffer limit(n)</td>
<td>设置缓冲区的limit为n，并返回修改后的Buffer对象</td>
</tr>
<tr>
<td>Buffer position(n)</td>
<td>设置缓冲区的position为n，并返回修改后的Buffer对象</td>
</tr>
<tr>
<td>bool hasRemaining()</td>
<td>判断缓冲区中是否还有元素</td>
</tr>
<tr>
<td>int remaining()</td>
<td>返回position 和 limit 之间的元素个数</td>
</tr>
<tr>
<td>Buffer mark()</td>
<td>对缓冲区设置标记</td>
</tr>
<tr>
<td>Buffer reset()</td>
<td>将位置 position 转到以前设置的 mark 所在的位置</td>
</tr>
<tr>
<td>Buffer rewind()</td>
<td>将位置设为0，取消设置的 mark</td>
</tr>
</tbody></table>
<h4 id="（4）缓冲区的数据操作"><a href="#（4）缓冲区的数据操作" class="headerlink" title="（4）缓冲区的数据操作"></a>（4）缓冲区的数据操作</h4><ul>
<li><p>Buffer 为所有子类提供了两个用于数据操作的方法：get() 和 put() 方法</p>
<ul>
<li><p>获取Buffer中的数据</p>
<p>get(): 读取单个字节</p>
<p>get(byte[] dst): 批量读取多个字节到dst中</p>
<p>get(int index): 读取指定索引位置的字节（不会移动position）</p>
</li>
<li><p>放入数据到Buffer中</p>
<p>put(byte b)：将给定单个字节写入缓冲区的当前位置</p>
<p>put(byte[] src)：将 src 中的字节写入缓冲区的当前位置</p>
<p>put(int index, byte b)：将指定字节写入缓冲区的索引位置(不会移动 position)</p>
</li>
</ul>
</li>
</ul>
<h4 id="（5）直接与非直接缓冲区"><a href="#（5）直接与非直接缓冲区" class="headerlink" title="（5）直接与非直接缓冲区"></a>（5）直接与非直接缓冲区</h4><img src="/Users/yyk/Library/Application Support/typora-user-images/image-20200421095630061.png" alt="image-20200421095630061" style="zoom:50%;" />

<p>![image-20200421095646435](/Users/yyk/Library/Application Support/typora-user-images/image-20200421095646435.png)</p>
<ul>
<li><p>字节缓冲区要么是直接的，要么是非直接的。如果为直接字节缓冲区，则 Java 虚拟机会尽最大努力直接在此缓冲区上执行本机 I/O 操作。也就是说，在每次调用基础操作系统的一个本机 I/O 操作之前（或之后），虚拟机都会尽量避免将缓冲区的内容复制到中间缓冲区中（或从中间缓冲区中复制内容）。</p>
</li>
<li><p>直接字节缓冲区可以通过调用此类的 allocateDirect() 工厂方法来创建。此方法返回的缓冲区进行分配和取消分配所需成本通常高于非直接缓冲区。直接缓冲区的内容可以驻留在常规的垃圾回收堆之外，因此，它们对应用程序的内存需求量造成的影响可能并不明显。所以，建议将直接缓冲区主要分配给那些易受基础系统的本机 I/O 操作影响的大型、持久的缓冲区。一般情况下，最好仅在直接缓冲区能在程序性能方面带来明显好处时分配它们。</p>
</li>
<li><p>直接字节缓冲区还可以通过 FileChannel 的 map() 方法 将文件区域直接映射到内存中来创建。该方法返回MappedByteBuffer 。Java 平台的实现有助于通过 JNI 从本机代码创建直接字节缓冲区。如果以上这些缓冲区中的某个缓冲区实例指的是不可访问的内存区域，则试图访问该区域不会更改该缓冲区的内容，并且将会在访问期间或稍后的某个时间导致抛出不确定的异常。</p>
</li>
<li><p>字节缓冲区是直接缓冲区还是非直接缓冲区可通过调用其 isDirect() 方法来确定。提供此方法是为了能够在性能关键型代码中执行显式缓冲区管理。</p>
</li>
</ul>
<h3 id="2-通道"><a href="#2-通道" class="headerlink" title="2. 通道"></a>2. 通道</h3><h4 id="（1）通道的概念"><a href="#（1）通道的概念" class="headerlink" title="（1）通道的概念"></a>（1）通道的概念</h4><ul>
<li><p>通道：由java.nio.channels包定义的，Channel表示IO源与目标打开的连接，Channel类似于传统的”流”，只不过Channel本身不能直接访问数据，Channel只能与Buffer 进行交互。</p>
<ul>
<li>最早由cpu处理IO操作</li>
</ul>
<img src="/Users/yyk/Library/Application Support/typora-user-images/image-20200421100128998.png" alt="image-20200421100128998" style="zoom:50%;" />

<ul>
<li><p>DMA方式，仍然需要CPU介入</p>
<p>![image-20200421100233520](/Users/yyk/Library/Application Support/typora-user-images/image-20200421100233520.png)</p>
</li>
<li><p>通道方式，通道本身也是处理器，可以独立处理IO操作</p>
<p>![image-20200421100313019](/Users/yyk/Library/Application Support/typora-user-images/image-20200421100313019.png)</p>
</li>
</ul>
</li>
<li><p>Java为 Channel 接口提供的最主要的实现类如下：</p>
<ul>
<li>FileChannel: 用于读取、写入、映射和操作文件的通道</li>
<li>DatagramChannel: 通过UDP读写网络中的数据通道</li>
<li>SocketChannel: 通过TCP读写网络中的数据</li>
<li>ServerSocketChannel: 可以监听新进来的 TCP 连接，对每一个新来的连接都会创建一个 SocketChannel</li>
</ul>
</li>
</ul>
<h4 id="（2）获取通道"><a href="#（2）获取通道" class="headerlink" title="（2）获取通道"></a>（2）获取通道</h4><ul>
<li><p>对支持通道的对象调用 getChannel() 方法。支持通道的类如下：</p>
<ul>
<li>FileInputStream</li>
<li>FileOutputStream</li>
<li>RandomAccessFile</li>
<li>DatagramSocket</li>
<li>Socket</li>
<li>serverSocket</li>
</ul>
</li>
<li><p>使用Files类的静态方法 newByteChannel() 获取字节通道</p>
</li>
<li><p>通过通道的静态方法open()打开并返回指定通道</p>
</li>
</ul>
<h4 id="（3）通道的数据传输"><a href="#（3）通道的数据传输" class="headerlink" title="（3）通道的数据传输"></a>（3）通道的数据传输</h4><ul>
<li><p>将 Buffer 中数据写入 Channel</p>
<pre class=" language-java"><code class="language-java"><span class="token keyword">int</span> bytesWritten <span class="token operator">=</span> outChannel<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
</li>
<li><p>从Channel中读取数据到Buffer中</p>
<pre class=" language-java"><code class="language-java"><span class="token keyword">int</span> bytesRead <span class="token operator">=</span> inChannel<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
</li>
</ul>
<p>例：文件复制，将已存在的1.png图片复制到文件2.png</p>
<pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">Test1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException <span class="token punctuation">{</span>
        FileInputStream fileInputStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span><span class="token string">"1.png"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        FileOutputStream fileOutputStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span><span class="token string">"2.png"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">//  获取通道</span>
        FileChannel inChannel <span class="token operator">=</span> fileInputStream<span class="token punctuation">.</span><span class="token function">getChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        FileChannel outChannel <span class="token operator">=</span> fileOutputStream<span class="token punctuation">.</span><span class="token function">getChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">//  分配指定大小的缓冲区</span>
        ByteBuffer byteBuffer <span class="token operator">=</span> ByteBuffer<span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">//  将通道中的数据写入缓冲区中   inChannel ---> byteBuffer   (此时写数据到缓冲区)</span>
        <span class="token keyword">while</span><span class="token punctuation">(</span>inChannel<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>byteBuffer<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">//  将缓冲区切换成读数据模式</span>
            byteBuffer<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment" spellcheck="true">//   byteBuffer ---> outChannel     (此时从缓冲区读数据)</span>
            outChannel<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>byteBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
            byteBuffer<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        outChannel<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        inChannel<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        fileInputStream<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        fileOutputStream<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span></code></pre>
<h3 id="3-分散-Scatter-和聚集-Gather"><a href="#3-分散-Scatter-和聚集-Gather" class="headerlink" title="3. 分散(Scatter)和聚集(Gather)"></a>3. 分散(Scatter)和聚集(Gather)</h3><ul>
<li><p>分散读取：指从Channel中读取的数据“分散”到多个Buffer中</p>
<p>![image-20200421102226878](/Users/yyk/Library/Application Support/typora-user-images/image-20200421102226878.png)</p>
<!--按照缓冲区的顺序，从Channel中读取的数据将以此将Buffer填满-->
</li>
<li><p>聚集写入：指将多个 Buffer 中的数据“聚集”到Channel</p>
</li>
</ul>
<p>![image-20200421102513458](/Users/yyk/Library/Application Support/typora-user-images/image-20200421102513458.png)</p>
<p>​        <!--按照缓冲区的顺序写入 position 和 limit 之间的数据到 Channel--></p>
<p>例：</p>
<ol>
<li><p>将数据从源通道传输到其他通道中，transferFrom() 方法</p>
<p><code>public abstract long transferFrom(ReadableByteChannel src, long position, long count) throws IOException;</code></p>
</li>
</ol>
<pre class=" language-java"><code class="language-java">inChannel <span class="token operator">=</span> FileChannel<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>Paths<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"1.png"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> StandardOpenOption<span class="token punctuation">.</span>READ<span class="token punctuation">)</span><span class="token punctuation">;</span>
outChannel <span class="token operator">=</span> FileChannel<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>Paths<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"3.png"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> StandardOpenOption<span class="token punctuation">.</span>WRITE<span class="token punctuation">,</span> StandardOpenOption<span class="token punctuation">.</span>READ<span class="token punctuation">,</span> StandardOpenOption<span class="token punctuation">.</span>CREATE_NEW<span class="token punctuation">)</span><span class="token punctuation">;</span>
outChannel<span class="token punctuation">.</span><span class="token function">transferFrom</span><span class="token punctuation">(</span>inChannel<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> inChannel<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<ol start="2">
<li>将数据从源通道传输到其他通道中，transferTo() 方法</li>
</ol>
<p><code>public abstract long transferTo(long position, long count, WritableByteChannel target) throws IOException;</code></p>
<pre class=" language-java"><code class="language-java">inChannel <span class="token operator">=</span> FileChannel<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>Paths<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"1.png"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> StandardOpenOption<span class="token punctuation">.</span>READ<span class="token punctuation">)</span><span class="token punctuation">;</span>
outChannel <span class="token operator">=</span> FileChannel<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>Paths<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"3.png"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> StandardOpenOption<span class="token punctuation">.</span>WRITE<span class="token punctuation">,</span>StandardOpenOption<span class="token punctuation">.</span>READ<span class="token punctuation">,</span> StandardOpenOption<span class="token punctuation">.</span>CREATE_NEW<span class="token punctuation">)</span><span class="token punctuation">;</span>
inChannel<span class="token punctuation">.</span><span class="token function">transferTo</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> inChannel<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> outChannel<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<ul>
<li>FileChannel的常用方法</li>
</ul>
<table>
<thead>
<tr>
<th>方法</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>int read(ByteBuffer dst)</td>
<td>从Channel中读取数据到ByteBuffer</td>
</tr>
<tr>
<td>Long read(ByteBuffer[] dsts)</td>
<td>将Channel中的数据“分散“到ByteBuffer[]</td>
</tr>
<tr>
<td>int write(ByteBuffer src)</td>
<td>将ByteBuffer中的数据写入到Channel</td>
</tr>
<tr>
<td>long write(ByteBuffer[] srcs)</td>
<td>将ByteBuffer[]中的数据”聚集“到Channel中</td>
</tr>
<tr>
<td>Long position()</td>
<td>返回此通道的文件位置</td>
</tr>
<tr>
<td>FileChannel position(long p)</td>
<td>设置此通道的文件位置</td>
</tr>
<tr>
<td>long size()</td>
<td>返回此通道的文件的当前大小</td>
</tr>
<tr>
<td>FileChannel truncate(long s)</td>
<td>将此通道的文件截取为给定大小</td>
</tr>
<tr>
<td>void force(boolean metaData)</td>
<td>强制将所有对此通道的文件更新写入到存储设备中</td>
</tr>
</tbody></table>
<h2 id="四、NIO的非阻塞式网络通信"><a href="#四、NIO的非阻塞式网络通信" class="headerlink" title="四、NIO的非阻塞式网络通信"></a>四、NIO的非阻塞式网络通信</h2><h3 id="1-阻塞与非阻塞"><a href="#1-阻塞与非阻塞" class="headerlink" title="1. 阻塞与非阻塞"></a>1. 阻塞与非阻塞</h3><ul>
<li>传统的IO流都是阻塞式的。也就是说，当一个线程调用 read() 或 write() 时，该线程被阻塞，直到有一些数据被读取或写入，该线程在此期间不能执行其他任务。因此，在完成网络通信进行 IO 操作时，由于线程会阻塞，所以服务器端必须为每个客户端都提供一个独立的线程进行处理，当服务器端需要处理大量客户端时，性能急剧下降。</li>
<li>Java NIO 是非阻塞模式的。当线程从某通道进行读写数据时，若没有数据可用时，该线程可以进行其他任务。线程通常将非阻塞 IO 的空闲时间用于在其他通道上执行 IO 操作，所以单独的线程可以管理多个输入和输出通道。因此，NIO 可以让服务器端使用一个或有限几个线程来同时处理连接到服务器端的所有客户端。</li>
</ul>
<h3 id="2-选择器（Selector）"><a href="#2-选择器（Selector）" class="headerlink" title="2. 选择器（Selector）"></a>2. 选择器（Selector）</h3><ul>
<li><p>选择器是SelectableChannel对象的多路复用器，Selector可以同时监控对个SelectableChannel的IO状况，也就是说，利用Selector可使一个单独的线程管理多个Channel。Selector是非阻塞IO的核心</p>
</li>
<li><p>SelectableChannel的结构如下：</p>
<img src="/Users/yyk/Library/Application Support/typora-user-images/image-20200421172908408.png" alt="image-20200421172908408" style="zoom:50%;" />

</li>
</ul>
<h3 id="3-选择器的应用"><a href="#3-选择器的应用" class="headerlink" title="3. 选择器的应用"></a>3. 选择器的应用</h3><ul>
<li><p>创建Selector：通过调用Selector.open()方法创建一个Selector。</p>
<pre class=" language-java"><code class="language-java">Selector selector <span class="token operator">=</span> Selector<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
</li>
<li><p>向选择器注册通道</p>
<pre class=" language-java"><code class="language-java">SelectionKey key <span class="token operator">=</span> channel<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>selector<span class="token punctuation">,</span> SelectionKey<span class="token punctuation">.</span>OP_READ<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
</li>
<li><p>当调用register(Selector sel, int ops)将通道注册选择器时，选择器对通道的监听事件，需要通过第二个参数ops指定</p>
</li>
<li><p>可以监听的事件类型（可使用SelectionKey的四个常量表示):</p>
<ul>
<li><p>读 : SelectionKey.OP_READ （1） </p>
</li>
<li><p>写 : SelectionKey.OP_WRITE （4） </p>
</li>
<li><p>连接 : SelectionKey.OP_CONNECT （8） </p>
</li>
<li><p>接收 : SelectionKey.OP_ACCEPT （16） </p>
</li>
</ul>
</li>
<li><p>当注册时不止监听一个事件，则可以用”位或“操作符连接</p>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//    注册监听事件</span>
<span class="token keyword">int</span> interestSet <span class="token operator">=</span> SelectionKey<span class="token punctuation">.</span>OP_READ <span class="token operator">|</span> SelectionKey<span class="token punctuation">.</span>OP_WRITE<span class="token punctuation">;</span></code></pre>
</li>
<li><p>Selector的常用方法</p>
<table>
<thead>
<tr>
<th>方法</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>Set<SelectionKey> keys()</td>
<td>返回注册在该Selector上的所有的 SelectionKey 集合</td>
</tr>
<tr>
<td>selectedKeys()</td>
<td>返回注册在该Selector上的已被选择的 SelectionKey 集合</td>
</tr>
<tr>
<td>int select()</td>
<td>监控所有注册的Channel，返回需要被处理的Channel数量</td>
</tr>
<tr>
<td>int select(long timeout)</td>
<td>可设置超时时长的select()操作</td>
</tr>
<tr>
<td>Selector wakeup()</td>
<td>使一个还未返回的select()方法立即返回</td>
</tr>
<tr>
<td>void close()</td>
<td>关闭该选择器</td>
</tr>
</tbody></table>
</li>
</ul>
<h3 id="4-SelectionKey"><a href="#4-SelectionKey" class="headerlink" title="4. SelectionKey"></a>4. SelectionKey</h3><ul>
<li><p>SelectionKey: 表示SelectableChannel 和 Selector之间的注册关系。每次选择器注册通道时就会选择一个事件（选择键）。选择键包含两个表示为整数值的操作集，操作集的每一位都表示该键的通道所支持的一类可选择操作。</p>
</li>
<li><p>方法</p>
<table>
<thead>
<tr>
<th>方法</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>Int interestsQps()</td>
<td>获取感兴趣事件集合</td>
</tr>
<tr>
<td>int readyOps()</td>
<td>获取通道已经准备就绪的操作的集合</td>
</tr>
<tr>
<td>SelectableChannel channel()</td>
<td>获取注册通道</td>
</tr>
<tr>
<td>Selector selector()</td>
<td>返回选择器</td>
</tr>
<tr>
<td>Boolean isReadable()</td>
<td>检测 Channel 中读事件是否就绪</td>
</tr>
<tr>
<td>Boolean isWriteable()</td>
<td>检测 Channel 中写事件是否就绪</td>
</tr>
<tr>
<td>Boolean isConnectable()</td>
<td>检测 Channel 中连接是否就绪</td>
</tr>
<tr>
<td>Boolean isAcceptable()</td>
<td>检测 Channel 中接收是否就绪</td>
</tr>
</tbody></table>
</li>
</ul>
<p>例：模拟客户端和服务器通信</p>
<pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestNonBlockingNIO</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">client</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">//  1.获取通道</span>
        SocketChannel socketChannel <span class="token operator">=</span> SocketChannel<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InetSocketAddress</span><span class="token punctuation">(</span><span class="token string">"127.0.0.1"</span><span class="token punctuation">,</span> <span class="token number">9898</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">//  2.切换非阻塞模式</span>
        socketChannel<span class="token punctuation">.</span><span class="token function">configureBlocking</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">//  3.分配指定大小的缓冲区</span>
        ByteBuffer byteBuffer <span class="token operator">=</span> ByteBuffer<span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">//  4.发送数据给服务端</span>
        byteBuffer<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        byteBuffer<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>scanner<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        byteBuffer<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        socketChannel<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>byteBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        byteBuffer<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


        <span class="token comment" spellcheck="true">//  5.关闭通道</span>
        socketChannel<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">server</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">//  1.获取通道</span>
        ServerSocketChannel serverSocketChannel <span class="token operator">=</span> ServerSocketChannel<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">//  2.切换非阻塞模式</span>
        serverSocketChannel<span class="token punctuation">.</span><span class="token function">configureBlocking</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">//  3.绑定连接</span>
        serverSocketChannel<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InetSocketAddress</span><span class="token punctuation">(</span><span class="token number">9898</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">//  4.获取选择器</span>
        Selector selector <span class="token operator">=</span> Selector<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">//  5.将通道注册到选择器，并且指定"监听接收事件"</span>
        serverSocketChannel<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>selector<span class="token punctuation">,</span> SelectionKey<span class="token punctuation">.</span>OP_ACCEPT<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">//  6.轮询式地获取选择器上已经"准备就绪"的事件</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>selector<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">//  7.获取当前选择器中所有注册的"选择键（已就绪的监听事件）"</span>
            Iterator<span class="token operator">&lt;</span>SelectionKey<span class="token operator">></span> iterator <span class="token operator">=</span> selector<span class="token punctuation">.</span><span class="token function">selectedKeys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">while</span> <span class="token punctuation">(</span>iterator<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment" spellcheck="true">//  8.获取准备就绪的事件</span>
                SelectionKey selectionKey <span class="token operator">=</span> iterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment" spellcheck="true">//  9.判断具体是什么事件准备就绪</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>selectionKey<span class="token punctuation">.</span><span class="token function">isAcceptable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment" spellcheck="true">//  10.若接收就绪，就获取客户端的连接</span>
                    SocketChannel socketChannel <span class="token operator">=</span> serverSocketChannel<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                    <span class="token comment" spellcheck="true">//  11.切换非阻塞模式</span>
                    socketChannel<span class="token punctuation">.</span><span class="token function">configureBlocking</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                    <span class="token comment" spellcheck="true">//  12.将该通道注册到选择器上,并且指定"监听读就绪事件"</span>
                    socketChannel<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>selector<span class="token punctuation">,</span> SelectionKey<span class="token punctuation">.</span>OP_READ<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>selectionKey<span class="token punctuation">.</span><span class="token function">isReadable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment" spellcheck="true">//  13.获取当前选择器上"读就绪"状态的通道</span>
                    SocketChannel socketChannel <span class="token operator">=</span> <span class="token punctuation">(</span>SocketChannel<span class="token punctuation">)</span> selectionKey<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                    <span class="token comment" spellcheck="true">//  14.读取数据</span>
                    ByteBuffer byteBuffer <span class="token operator">=</span> ByteBuffer<span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                    <span class="token keyword">int</span> len <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
                    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>len <span class="token operator">=</span> socketChannel<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>byteBuffer<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        byteBuffer<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>byteBuffer<span class="token punctuation">.</span><span class="token function">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> len<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        byteBuffer<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
                <span class="token comment" spellcheck="true">//  15.取消选择键selectionKey</span>
                iterator<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<h2 id="五、管道"><a href="#五、管道" class="headerlink" title="五、管道"></a>五、管道</h2><p>​        Java NIO 管道是2个线程之间的单向数据连接。Pipe有一个source通道和一个sink通道。数据会被写到sink通道，从source通道读取。</p>
<p>![image-20200421183721288](/Users/yyk/Library/Application Support/typora-user-images/image-20200421183721288.png)</p>
<p>例：向管道中写数据后读出：</p>
<pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">//  1.获取管道</span>
        Pipe pipe <span class="token operator">=</span> Pipe<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//  2.将缓冲区中的数据写入管道</span>
        ByteBuffer byteBuffer <span class="token operator">=</span> ByteBuffer<span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Pipe<span class="token punctuation">.</span>SinkChannel sinkChannel <span class="token operator">=</span> pipe<span class="token punctuation">.</span><span class="token function">sink</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        byteBuffer<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"通过单向管道发送数据"</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        byteBuffer<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        sinkChannel<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>byteBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        byteBuffer<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">//  3.将管道中的数据写入缓冲区</span>
        Pipe<span class="token punctuation">.</span>SourceChannel sourceChannel <span class="token operator">=</span> pipe<span class="token punctuation">.</span><span class="token function">source</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        sourceChannel<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>byteBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        byteBuffer<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>byteBuffer<span class="token punctuation">.</span><span class="token function">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> byteBuffer<span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span></code></pre>
<h2 id="六、NIO-2-–-Path、Paths、Files"><a href="#六、NIO-2-–-Path、Paths、Files" class="headerlink" title="六、NIO.2 – Path、Paths、Files"></a>六、NIO.2 – Path、Paths、Files</h2><h3 id="1-NIO-2"><a href="#1-NIO-2" class="headerlink" title="1. NIO.2"></a>1. NIO.2</h3><p>​        随着 JDK 7 的发布，Java对NIO进行了极大的扩展，增强了对文件处理和文件系统特性的支持，以至于我们称他们为 NIO.2。因为 NIO 提供的一些功能，NIO已经成为文件处理中越来越重要的部分。</p>
<h3 id="2-Path与Paths"><a href="#2-Path与Paths" class="headerlink" title="2. Path与Paths"></a>2. Path与Paths</h3><ul>
<li>Java.io.file.Path接口代表一个平台无关的平台路径，描述了目录结构中文件的位置</li>
<li>Paths 提供的get()方法用来获取 Path 对象<ul>
<li>Paths.get(String, String … more): 用于将多个字符串串连成路径</li>
</ul>
</li>
<li>Path 常用方法：</li>
</ul>
<table>
<thead>
<tr>
<th>方法</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>boolean endsWith(String path)</td>
<td>判断是否以path路径结束</td>
</tr>
<tr>
<td>boolean startsWith(String path)</td>
<td>判断是否以path路径开始</td>
</tr>
<tr>
<td>boolean isAbsolute()</td>
<td>判断是否是绝对路径</td>
</tr>
<tr>
<td>Path getFileName()</td>
<td>返回与调用Path对象关联的文件名</td>
</tr>
<tr>
<td>Path getName(int index)</td>
<td>返回指定所用位置index的路径名称</td>
</tr>
<tr>
<td>int getNameCount()</td>
<td>返回Path根目录后面元素的数量</td>
</tr>
<tr>
<td>Path getParent()</td>
<td>返回Path对象包含整个路径，不包含 Path 对象指定的文件路径</td>
</tr>
<tr>
<td>Path getRoot()</td>
<td>返回调用 Path 对象的根路径</td>
</tr>
<tr>
<td>Path resolve(Path p)</td>
<td>将相对路径解析为绝对路径</td>
</tr>
<tr>
<td>Path toAbsolutePath()</td>
<td>作为绝对路径返回调用 Path 对象</td>
</tr>
<tr>
<td>String toString()</td>
<td>返回调用 Path 对象的字符串表示形式</td>
</tr>
</tbody></table>
<h3 id="3-Files类"><a href="#3-Files类" class="headerlink" title="3.Files类"></a>3.Files类</h3><ul>
<li><p>Java.nio.file.Files用于操作文件或目录的工具类</p>
</li>
<li><p>Files常用方法</p>
<table>
<thead>
<tr>
<th>方法</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>Path copy(Path src, Path dest, CopyOption … how)</td>
<td>文件的复制</td>
</tr>
<tr>
<td>Path createDirectory(Path path, FileAttribute&lt;?&gt; …attr)</td>
<td>创建一个目录</td>
</tr>
<tr>
<td>Path CreateFile(Path path,  FileAttribute&lt;?&gt; … arr)</td>
<td>创建一个文件</td>
</tr>
<tr>
<td>Void delete(Path path)</td>
<td>删除一个文件</td>
</tr>
<tr>
<td>Path move(Path src, Path dst, CopyOption …how)</td>
<td>将src移动到dst位置</td>
</tr>
<tr>
<td>Path move(Path src, Path dest, CopyOption…how)</td>
<td>将 src 移动到 dest 位置</td>
</tr>
<tr>
<td>long size(Path path)</td>
<td>返回 path 指定文件的大小</td>
</tr>
</tbody></table>
</li>
</ul>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/NIO/" rel="tag"># NIO</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2020/05/08/leetcode-bytedance/" rel="prev" title="1. 两数之和">
      <i class="fa fa-chevron-left"></i> 1. 两数之和
    </a></div>
      <div class="post-nav-item">
    <a href="/2020/05/10/heap-sort/" rel="next" title="heap-sort">
      heap-sort <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Java-NIO学习笔记"><span class="nav-number">1.</span> <span class="nav-text">Java NIO学习笔记</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#一、Java-NIO简介"><span class="nav-number">1.1.</span> <span class="nav-text">一、Java NIO简介</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#二、Java-NIO-与-IO-的主要区别"><span class="nav-number">1.2.</span> <span class="nav-text">二、Java NIO 与 IO 的主要区别</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#三、通道和缓冲区"><span class="nav-number">1.3.</span> <span class="nav-text">三、通道和缓冲区</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-缓冲区"><span class="nav-number">1.3.1.</span> <span class="nav-text">1. 缓冲区</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#（1）缓冲区的基本概念"><span class="nav-number">1.3.1.1.</span> <span class="nav-text">（1）缓冲区的基本概念</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#（2）缓冲区的基本属性"><span class="nav-number">1.3.1.2.</span> <span class="nav-text">（2）缓冲区的基本属性</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#（3）缓冲区的常用方法"><span class="nav-number">1.3.1.3.</span> <span class="nav-text">（3）缓冲区的常用方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#（4）缓冲区的数据操作"><span class="nav-number">1.3.1.4.</span> <span class="nav-text">（4）缓冲区的数据操作</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#（5）直接与非直接缓冲区"><span class="nav-number">1.3.1.5.</span> <span class="nav-text">（5）直接与非直接缓冲区</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-通道"><span class="nav-number">1.3.2.</span> <span class="nav-text">2. 通道</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#（1）通道的概念"><span class="nav-number">1.3.2.1.</span> <span class="nav-text">（1）通道的概念</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#（2）获取通道"><span class="nav-number">1.3.2.2.</span> <span class="nav-text">（2）获取通道</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#（3）通道的数据传输"><span class="nav-number">1.3.2.3.</span> <span class="nav-text">（3）通道的数据传输</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-分散-Scatter-和聚集-Gather"><span class="nav-number">1.3.3.</span> <span class="nav-text">3. 分散(Scatter)和聚集(Gather)</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#四、NIO的非阻塞式网络通信"><span class="nav-number">1.4.</span> <span class="nav-text">四、NIO的非阻塞式网络通信</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-阻塞与非阻塞"><span class="nav-number">1.4.1.</span> <span class="nav-text">1. 阻塞与非阻塞</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-选择器（Selector）"><span class="nav-number">1.4.2.</span> <span class="nav-text">2. 选择器（Selector）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-选择器的应用"><span class="nav-number">1.4.3.</span> <span class="nav-text">3. 选择器的应用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-SelectionKey"><span class="nav-number">1.4.4.</span> <span class="nav-text">4. SelectionKey</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#五、管道"><span class="nav-number">1.5.</span> <span class="nav-text">五、管道</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#六、NIO-2-–-Path、Paths、Files"><span class="nav-number">1.6.</span> <span class="nav-text">六、NIO.2 – Path、Paths、Files</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-NIO-2"><span class="nav-number">1.6.1.</span> <span class="nav-text">1. NIO.2</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-Path与Paths"><span class="nav-number">1.6.2.</span> <span class="nav-text">2. Path与Paths</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-Files类"><span class="nav-number">1.6.3.</span> <span class="nav-text">3.Files类</span></a></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="余永康"
      src="https://edu-online-1258760161.cos.ap-guangzhou.myqcloud.com/2020/06/30/240c57a76f364ab59770c641afc2693c11.jpg">
  <p class="site-author-name" itemprop="name">余永康</p>
  <div class="site-description" itemprop="description">只有光头才能变强</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">10</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">7</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">余永康</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
